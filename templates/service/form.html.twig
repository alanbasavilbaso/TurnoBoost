<form method="post" action="{{ path(is_edit ? 'app_service_edit' : 'app_service_new', is_edit ? {'id': service.id} : {}) }}">
    {{ form_start(form, {'render_rest': false}) }}
    
    <!-- Información del Servicio -->
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form_label(form.name, 'Nombre del Servicio *', {'label_attr': {'class': 'form-label'}}) }}
            {{ form_widget(form.name, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    {{ form_label(form.onlineBookingEnabled, 'Reservas Online', {'label_attr': {'class': 'form-label mb-1 fw-semibold'}}) }}
                    <small class="text-muted d-block">Permite a los pacientes reservar online</small>
                </div>
                <div class="form-check form-switch ms-3">
                    {{ form_widget(form.onlineBookingEnabled, {'attr': {'class': 'form-check-input', 'role': 'switch'}}) }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form_label(form.defaultDurationMinutes, 'Duración (minutos) *', {'label_attr': {'class': 'form-label'}}) }}
            {{ form_widget(form.defaultDurationMinutes, {'attr': {'class': 'form-control', 'min': '1'}}) }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form_label(form.price, 'Precio', {'label_attr': {'class': 'form-label'}}) }}
            <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form_widget(form.price, {'attr': {'class': 'form-control', 'step': '0.01', 'min': '0'}}) }}
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        {{ form_label(form.description, 'Descripción', {'label_attr': {'class': 'form-label'}}) }}
        {{ form_widget(form.description, {'attr': {'class': 'form-control', 'rows': '3'}}) }}
    </div>
    
    <!-- Configuración de Reservas -->
    <hr class="my-4">
    <h6 class="mb-3">
        <i class="fas fa-cogs text-primary me-2"></i>
        Configuración de Reservas
    </h6>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form_label(form.deliveryType, 'Tipo de Entrega', {'label_attr': {'class': 'form-label'}}) }}
            <div class="delivery-type-container">
                {{ form_widget(form.deliveryType) }}
            </div>
        </div>
        <div class="col-md-6 mb-3">
            {{ form_label(form.serviceType, 'Tipo de Servicio', {'label_attr': {'class': 'form-label'}}) }}
            <div class="service-type-container">
                {{ form_widget(form.serviceType) }}
            </div>
        </div>
    </div>
    
    <!-- Campo de frecuencia - solo visible para servicios recurrentes -->
    <div class="row mb-3 frequency-row" style="display: none;">
        <div class="col-md-12">
            <div class="frequency-field">
                {{ form_label(form.frequencyWeeks, 'Frecuencia (semanas)', {'label_attr': {'class': 'form-label'}}) }}
                <div class="frequency-container">
                    {{ form_widget(form.frequencyWeeks) }}
                </div>
                <div class="form-text">
                    Cada cuántas semanas se debe repetir este servicio.
                </div>
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        {{ form_label(form.reminderNote, 'Nota de Recordatorio', {'label_attr': {'class': 'form-label'}}) }}
        {{ form_widget(form.reminderNote, {'attr': {'class': 'form-control', 'rows': '2'}}) }}
        <div class="form-text">
            Texto adicional que se incluirá en los recordatorios de citas para este servicio.
        </div>
    </div>
    
    {% if is_edit and service.appointments|length > 0 %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Nota:</strong> Este servicio tiene {{ service.appointments|length }} cita(s) asociada(s). 
            Los cambios en precio y duración no afectarán las citas existentes.
        </div>
    {% endif %}
    
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancelar
        </button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>{{ is_edit ? 'Actualizar' : 'Crear' }} Servicio
        </button>
    </div>
    
    {{ form_rest(form) }}
    {{ form_end(form, {'render_rest': false}) }}
</form>

<script>
// Lógica para mostrar/ocultar campo de frecuencia
document.addEventListener('DOMContentLoaded', function() {
    const serviceTypeSelect = document.getElementById('serviceType');
    const frequencyRow = document.querySelector('.frequency-row');
    
    function toggleFrequencyField() {
        if (serviceTypeSelect && frequencyRow) {
            const isRecurrent = serviceTypeSelect.value === 'recurrent';
            frequencyRow.style.display = isRecurrent ? 'block' : 'none';
        }
    }
    
    if (serviceTypeSelect) {
        serviceTypeSelect.addEventListener('change', toggleFrequencyField);
        toggleFrequencyField(); // Ejecutar al cargar
    }
});
</script>