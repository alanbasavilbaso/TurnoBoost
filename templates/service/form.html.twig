<form method="post" action="{{ path(is_edit ? 'app_service_edit' : 'app_service_new', is_edit ? {'id': service.id} : {}) }}">
    {{ form_start(form, {'render_rest': false}) }}
    
    <!-- Información del Servicio -->
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form_label(form.name, 'Nombre del Servicio *', {'label_attr': {'class': 'form-label'}}) }}
            {{ form_widget(form.name, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    {{ form_label(form.onlineBookingEnabled, 'Reservas Online', {'label_attr': {'class': 'form-label mb-1 fw-semibold'}}) }}
                    <small class="text-muted d-block">Permite a los pacientes reservar online</small>
                </div>
                <div class="form-check form-switch ms-3">
                    {{ form_widget(form.onlineBookingEnabled, {'attr': {'class': 'form-check-input', 'role': 'switch', 'id': 'onlineBookingEnabled'}}) }}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Opciones de reserva online (solo visibles si está habilitado) -->
    <div class="row booking-options" id="bookingOptions" style="display: none;">
        <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    {{ form_label(form.showPriceOnBooking, 'Mostrar Precio', {'label_attr': {'class': 'form-label mb-1'}}) }}
                    <small class="text-muted d-block">El precio será visible al reservar</small>
                </div>
                <div class="form-check form-switch ms-3">
                    {{ form_widget(form.showPriceOnBooking, {'attr': {'class': 'form-check-input', 'role': 'switch'}}) }}
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    {{ form_label(form.showDurationOnBooking, 'Mostrar Duración', {'label_attr': {'class': 'form-label mb-1'}}) }}
                    <small class="text-muted d-block">La duración será visible al reservar</small>
                </div>
                <div class="form-check form-switch ms-3">
                    {{ form_widget(form.showDurationOnBooking, {'attr': {'class': 'form-check-input', 'role': 'switch'}}) }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form_label(form.defaultDurationMinutes, 'Duración (minutos) *', {'label_attr': {'class': 'form-label'}}) }}
            {{ form_widget(form.defaultDurationMinutes, {'attr': {'class': 'form-control', 'min': '1'}}) }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form_label(form.price, 'Precio', {'label_attr': {'class': 'form-label'}}) }}
            <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form_widget(form.price, {'attr': {'class': 'form-control', 'step': '0.01', 'min': '0'}}) }}
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        {{ form_label(form.description, 'Descripción', {'label_attr': {'class': 'form-label'}}) }}
        {{ form_widget(form.description, {'attr': {'class': 'form-control', 'rows': '3'}}) }}
    </div>
    
    <!-- Sección de Imágenes -->
    <hr class="my-4">
    <h6 class="mb-3">
        <i class="fas fa-images text-primary me-2"></i>
        Imágenes del Servicio
        <p class="text-muted small">
            ¡Carga hasta 2 imágenes de tu servicio! Te recomendamos que tengan un tamaño mínimo de 200x200px y un peso máximo de 3MB.
        </p>
    </h6>
    
    <div class="row">
        <!-- Imagen Principal -->
        <div class="col-md-6">
            <div class="image-upload-section">
                {{ form_label(form.imageFile1, 'Imagen Principal', {'label_attr': {'class': 'form-label'}}) }}
                
                {% if service.imageUrl1 %}
                    <div class="current-image-preview mb-2">
                        <img src="{{ service.imageUrl1 }}" alt="Imagen principal actual" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
                        <small class="text-muted d-block">Imagen principal actual</small>
                    </div>
                {% endif %}
                
                {{ form_widget(form.imageFile1, {'attr': {'class': 'form-control', 'accept': 'image/*'}}) }}
                {{ form_help(form.imageFile1) }}
                
                {% if form.imageFile1.vars.errors|length > 0 %}
                    <div class="text-danger small mt-1">
                        {{ form_errors(form.imageFile1) }}
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Imagen Secundaria -->
        <div class="col-md-6">
            <div class="image-upload-section">
                {{ form_label(form.imageFile2, 'Imagen Secundaria', {'label_attr': {'class': 'form-label'}}) }}
                
                {% if service.imageUrl2 %}
                    <div class="current-image-preview mb-2">
                        <img src="{{ service.imageUrl2 }}" alt="Imagen secundaria actual" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
                        <small class="text-muted d-block">Imagen secundaria actual</small>
                    </div>
                {% endif %}
                
                {{ form_widget(form.imageFile2, {'attr': {'class': 'form-control', 'accept': 'image/*'}}) }}
                {{ form_help(form.imageFile2) }}
                
                {% if form.imageFile2.vars.errors|length > 0 %}
                    <div class="text-danger small mt-1">
                        {{ form_errors(form.imageFile2) }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Configuración de Reservas -->
    <hr class="my-4">
    <h6 class="mb-3 hide">
        <i class="fas fa-cogs text-primary me-2"></i>
        Configuración de Reservas
    </h6>
    
    <div class="row hide">
        <div class="col-md-6 mb-3">
            {{ form_label(form.deliveryType, 'Tipo de Entrega', {'label_attr': {'class': 'form-label'}}) }}
            <div class="delivery-type-container">
                {{ form_widget(form.deliveryType) }}
            </div>
        </div>
        <div class="col-md-6 mb-3">
            {{ form_label(form.serviceType, 'Tipo de Servicio', {'label_attr': {'class': 'form-label'}}) }}
            <div class="service-type-container">
                {{ form_widget(form.serviceType) }}
            </div>
        </div>
    </div>
    
    <!-- Campo de frecuencia - solo visible para servicios recurrentes -->
    <div class="row mb-3 frequency-row" style="display: none;">
        <div class="col-md-12">
            <div class="frequency-field">
                {{ form_label(form.frequencyWeeks, 'Frecuencia (semanas)', {'label_attr': {'class': 'form-label'}}) }}
                <div class="frequency-container">
                    {{ form_widget(form.frequencyWeeks) }}
                </div>
                <div class="form-text">
                    Cada cuántas semanas se debe repetir este servicio.
                </div>
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        {{ form_label(form.reminderNote, 'Nota de Recordatorio', {'label_attr': {'class': 'form-label'}}) }}
        {{ form_widget(form.reminderNote, {'attr': {'class': 'form-control', 'rows': '2'}}) }}
        <div class="form-text">
            Texto adicional que se incluirá en los recordatorios de citas para este servicio.
        </div>
    </div>
    
    {% if is_edit and service.appointments|length > 0 %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Nota:</strong> Los cambios en precio y duración no afectarán las citas existentes.
        </div>
    {% endif %}
    
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancelar
        </button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>{{ is_edit ? 'Actualizar' : 'Crear' }} Servicio
        </button>
    </div>
    
    {{ form_rest(form) }}
    {{ form_end(form, {'render_rest': false}) }}
</form>